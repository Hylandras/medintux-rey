<!DOCTYPE CMenu><CMenu version="0.0" stdsetdef="1">
<actions>
	<action>
		<property name="name">
			<cstring>Afficher les rappels</cstring>
		</property>
		<property name="iconSet">
			<iconset>reminder.png</iconset>
		</property>
		<property name="text">
			<string>Afficher les rappels</string>
		</property>
		<property name="menuText">
			<string>Afficher les rappels</string>
		</property>
		<property name="accel">
			<string>Ctrl+r</string>
		</property>
		<property name="script">
			<string>
{{:: SET_VAR(dueDateResult, )}}
{{:: SET_VAR(todoResult, )}}

{{REM= one query for one section. First the expired ones}}
{{::# SQL_SELECT ( ToDo INNER JOIN RubriquesHead ON ToDo.Memo_PK=RubriquesHead.RbDate_PrimKey , ToDo.DateReminder|ToDo.DueDate|ToDo.Title|RubriquesHead.RbDate_NomDate , WHERE ToDo.DueDate<='{{DT=yyyy-MM-dd}}' AND ToDo.GUID='{{GET_DOSS_GUID}}',200,%, ,<br  /> <b>%2</b><ul><li>La date butoir était fixée au <i><span style="font-weight:600;color:#ff0000">%1</span></i></li><li>La date de rappel était fixée au <i><span style="font-weight:600;color:#610B21">%0</span></i></li><li>Pour plus d'informations&#44; consultez le mémo suivant &nbsp; ==> &nbsp; <i><u>%3</u></i></li></ul>)&gt;queryResult}}
{{REM= ::# MESSAGE_ALERT({{VAR=queryResult}})}}
{{:: TEST(S,{{VAR=queryResult}},!=,,&nbsp;,FLAG_FALSE)&gt;validAction}}
{{REM= ::# MESSAGE_ALERT({{VAR=validAction}})}}
{{REM= We fill popupText with error messages. If not altered it will allow execution of tests to ensure that final error popup will display at what stage the macro broke.}}
{{:: TEST(S,{{VAR=validAction}},=,FLAG_FALSE,ERREUR !!! La requête pour les rappels dépassés a échoué,TEST)&gt;popupText}}
{{REM= we use an intermediate var so we'll can concatenate them at the end of the macro}}
{{::# {{VAR=validAction}}SET_VAR(dueDateResult,<center><span style="font-size:16pt;font-weight:600;color:#ff0000">!!! DATE DÉPASSÉE !!!</span></center> {{VAR=queryResult}}<br />)}}

{{REM= then the things planned for the next 90 days}}
{{::# SQL_SELECT ( ToDo INNER JOIN RubriquesHead ON ToDo.Memo_PK=RubriquesHead.RbDate_PrimKey , ToDo.DateReminder|ToDo.DueDate|ToDo.Title|RubriquesHead.RbDate_NomDate , WHERE ToDo.DueDate<'NOW&#40;&#41; + INTERVAL 90 DAY' AND ToDo.DueDate>'{{DT=yyyy-MM-dd}}' AND ToDo.GUID='{{GET_DOSS_GUID}}',200,%, ,<br  /> <b>%2</b><ul><li>Doit être effectué avant le <i><span style="font-weight:600;color:#ff00ff">%1</span></i></li><li>Date de rappel fixée au <i><span style="font-weight:600;color:#dba901">%0</span></i></li><li>Pour plus d'informations&#44; consultez le mémo suivant &nbsp; ==> &nbsp; <i><u>%3</u></i></li></ul>)&gt;queryResult}}
{{:: TEST(S,{{VAR=queryResult}},!=,,&nbsp;,FLAG_FALSE)&gt;validAction}}
{{REM= We fill popupText with error messages. If not altered it will allow execution of tests to ensure that final error popup will display at what stage the macro broke.}}
{{:: TEST(S,{{VAR=validAction}},=,FLAG_FALSE,ERREUR !!! La requête pour les rappels à venir dans les 90 prochains jours a échoué,TEST)&gt;popupText}}
{{REM= we use an intermediate var so we'll can concatenate them at the end}}
{{::# {{VAR=validAction}}SET_VAR(todoResult,{{VAR=dueDateResult}}<center><span style="font-size:16pt;font-weight:600">À faire dans les 3 prochains mois</span></center>{{VAR=queryResult}})}}

{{:: TEST(S,{{VAR=todoResult}},!=,,MESSAGE_ALERT,)&gt;doMessage}}
{{::# {{VAR=doMessage}}({{VAR=todoResult}},Rappels & Alertes pour ce patient,,,,,650,350) }}

{{REM= If validAction was filled we display a message to help troubleshooting}}
{{:: TEST(S,{{VAR=validAction}},=,FLAG_FALSE,MESSAGE_POPUP,)&gt;doPopup}}
{{:: {{VAR=doPopup}}({{VAR=popupText}},,{{VAR=popupFading}})}}
			</string>
		</property>
		<property name="period">
			<string>-100</string>
		</property>
	</action>
</actions>
