<html><head><meta name="qrichtext" content="charset=utf-8" /></head>
<body style="font-size:10pt;font-family:Sans">
<p>{{REM= we extract the first page of the pdf and transform it to PNG so macros will be able to insert previews}}
{{REM= It is necessary to install ImageMagick for Linux compatibility and we test if it is}}
{{:: SI(S,{{FE={{VAR=drtuxDepth}}/usr/bin/convert}},=,,FLAG_FALSE,)&gt;validAction}}
{{:: {{VAR=popupText}}(S,{{VAR=validAction}},=,FLAG_FALSE,ERREUR !!! ImageMagick introuvable,TEST)&gt;popupText}}
{{REM= We also test if the patient file directory was created}}
{{:: {{VAR=validAction}}SI(S,{{FE={{VAR=PatientFiles}}}},=,,FLAG_FALSE,)&gt;validAction}}
{{:: {{VAR=popupText}}(S,{{VAR=validAction}},=,FLAG_FALSE,ERREUR !!! Répertoire du patient introuvable,TEST)&gt;popupText}}

{{REM= we convert PDF file to PNG format}}
{{:: {{VAR= validAction}} EXE_PROCESS(WaitEnd, /usr/bin/convert, convert,-density,300,-trim, $ToAbsPath{{VAR=tmpFiles}}/include_pdf.tmp.pdf,-quality,100,-sharpen,0x1.0, $ToAbsPath{{VAR = tmpFiles}}/preview_pdf_%02d.png)}}

{{REM= It is necessary to install Tesseract for Linux compatibility so we test if it is}}
{{:: {{VAR=validAction}}SI(S,{{FE={{VAR=drtuxDepth}}/usr/bin/tesseract}},=,,FLAG_FALSE,)&gt;validAction}}
{{:: {{VAR=popupText}}(S,{{VAR=validAction}},=,FLAG_FALSE,ERREUR !!! Tesseract introuvable,TEST)&gt;popupText}}
{{REM= ###TODO### we need to prompt user for language}}

{{REM= We test if pdf had multiple pages}}
{{:: {{VAR=validAction}}SI(S,{{FE=$ToAbsPath{{VAR = tmpFiles}}/preview_pdf_01.png}},=,,NO,YES)&gt;useWildcard}}

{{:: {{VAR= validAction}} SI(S,{{VAR=doOCR}},=,OCR_FLAG_FALSE,NO,YES)&gt;doOCR2Tess}}

{{:: {{VAR= validAction}} EXE_PROCESS(WaitEnd,../../../Glossaire/INCLUDE/attachments/medintux2tess4attachments.sh,{{VAR= useWildcard}},-l fra,$ToAbsPath{{VAR= tmpFiles}}$EndToAbsPath/,nodebug,{{VAR=doOCR2Tess}},$ToAbsPath{{VAR= logDir}}$EndToAbsPath/)}}
{{:: {{VAR= validAction}} {{VAR= doOCR}} SI(S,{{FE={{VAR = tmpFiles}}/ocr_pdf.txt}},=,,FLAG_FALSE,)&gt;validAction}}
{{:: {{VAR= popupText}}(S,{{VAR= validAction}},=,FLAG_FALSE,ERREUR !!! Échec OCR,TEST)&gt;popupText}}
{{:: {{VAR= validAction}} COPY_FILE($ToAbsPath {{VAR=tmpFiles}}/ocr_pdf.txt, $ToAbsPath{{VAR= PatientFiles}}/{{VAR= finalFilename}}.ocr.txt, $remove_src_file)}}
{{:: {{VAR= validAction}} {{VAR= doOCR}} SI(S,{{FE={{VAR=PatientFiles}}/{{VAR=finalFilename}}.ocr.txt}},=,,FLAG_FALSE,)&gt;validAction}}
{{:: {{VAR= popupText}}(S,{{VAR= validAction}},=,FLAG_FALSE,ERREUR !!! Échec déplacement OCR,TEST)&gt;popupText}}
</p></body></html>
