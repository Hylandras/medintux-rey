<html><head><meta name="qrichtext" content="1" /></head><body style="font-size:8pt;font-family:MS Shell Dlg">
<p>$start_titleMettre à jour la date de rappel<br /><br /> <i>Les éléments suivants seronts mis à jour,<br />en fonction des données du mémo :<ul><li>Le titre du mémo</li><li>La date de rappel</li><li>Le nom de l'intervenant ayant validé ce rappel</li></ul></i>$end_title
{{REM= To ensure that Memos and Reminders work you need to have a dummy user with "remind" as Login}}

{{REM= we reset agendaPK in case it was filled by a previous macro}}
{{:: {{VAR=validAction}}SET_VAR(agendaPK,0)}}

{{:: SQL_GET_RUB_HEAD_PK(Documents)&gt;memoPK}}
{{:: SQL_SELECT ( ToDo , Agenda_PK , WHERE Memo_PK={{VAR=memoPK}},20,%, ,%0)&gt;agendaPK}}
{{:: TEST(N,{{VAR=agendaPK}},>,0,&nbsp;,FLAG_FALSE)&gt;validAction}}
{{REM= We fill popupText with error messages. If not altered it will allow execution of tests to ensure that final error popup will display at what stage the macro broke.}}
{{:: TEST(S,{{VAR=validAction}},=,FLAG_FALSE,ERREUR !!! Le rappel n'a pas encore été enregistré,TEST)&gt;popupText}}

{{REM= resetting vars for extracts}}
{{:: {{VAR=validAction}}SET_VAR(memoTitle, )}}
{{:: {{VAR=validAction}}SET_VAR(memoReminder, )}}
{{REM= we extract title and date to perform a test to prevent execution if they are not filled}}
{{:: {{VAR=validAction}}Extract(Documents,Sujet,EOL)&gt;memoTitle}}
{{:: {{VAR=validAction}}Extract(Documents,Date de rappel,EOL)&gt;memoReminder}}
{{REM= test if memoTitle, memoReminder, and memoDueDate are filled}}
{{:: {{VAR=validAction}}TEST(S,{{VAR=memoTitle}},=,&nbsp;,FLAG_FALSE,)&gt;validAction}}
{{:: {{VAR=popupText}}(S,{{VAR=validAction}},=,FLAG_FALSE,ERREUR !!! Vérifiez le titre,TEST)&gt;popupText}}
{{:: {{VAR=validAction}}TEST(S,{{VAR=memoReminder}},=,&nbsp;,FLAG_FALSE,)&gt;validAction}}
{{:: {{VAR=popupText}}(S,{{VAR=validAction}},=,FLAG_FALSE,ERREUR !!! Vérifiez la date de rappel,TEST)&gt;popupText}}

{{:: {{VAR=validAction}}SQL_WRITE (agenda, PrimKey='{{VAR=agendaPK}}' ,Date_Time,{{VAR=memoReminder}} {{HHHMM}}:00,RDV_PrisPar,{{USER LOGIN MEDECIN}},Note,{{:: CS({{VAR=memoTitle}})}}) }}

{{:: {{VAR=validAction}}SET_VAR(testQuery,0)}}
{{::# {{VAR=validAction}}SQL_SELECT ( agenda , PrimKey , WHERE PrimKey='{{VAR=agendaPK}}' AND Date_Time='{{VAR=memoReminder}} {{HHHMM}}:00' AND RDV_PrisPar='{{USER LOGIN MEDECIN}}' AND Note='{{:: CS({{VAR=memoTitle}})}}',20,%, ,%0)&gt;testQuery}}
{{:: {{VAR=validAction}}TEST(N,{{VAR=testQuery}},>,0,&nbsp;,FLAG_FALSE)&gt;validAction}}
{{:: {{VAR=popupText}}(S,{{VAR=validAction}},=,FLAG_FALSE,ERREUR CRITIQUE (agenda) !!! Veuillez contacter l'administrateur,TEST)&gt;popupText}}
{{REM=  if the query was validated, then we write the modification date}}
{{::# {{VAR=validAction}}Extract(Documents,==============================,$ToEnd,Enregistrer les rappels pour ce mémo,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#00ff00"><b>Rappel modifié le {{DT=yyyy-MM-dd}}</b></span>)}}

{{REM= If validAction was filled we display a message to help troubleshooting}}
{{:: TEST(S,{{VAR=validAction}},=,FLAG_FALSE,MESSAGE_POPUP,)&gt;doPopup}}
{{:: {{VAR=doPopup}}({{VAR=popupText}},,{{VAR=popupFading}})}}
</p>
</body></html>
